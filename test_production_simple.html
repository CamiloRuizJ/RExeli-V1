<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RExeli V1 Production Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .loading { background-color: #cce5ff; border: 1px solid #99d3ff; color: #004085; }
        button { background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #0056b3; }
        #results { margin-top: 20px; }
        .test-section { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>RExeli V1 Production Testing Dashboard</h1>
    <p>This page tests the production deployment of RExeli V1 to ensure all components are working correctly.</p>
    
    <div class="test-section">
        <h2>Quick Tests</h2>
        <button onclick="testBasicFunctionality()">Test Basic Functionality</button>
        <button onclick="testAPIEndpoints()">Test API Endpoints</button>
        <button onclick="testFileUpload()">Test File Upload</button>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div id="results"></div>

    <script>
        const baseUrl = 'https://rexeli-v1.vercel.app';
        
        function addResult(testName, status, message) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${status}`;
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testBasicFunctionality() {
            addResult('Basic Functionality', 'loading', 'Testing application load...');
            
            try {
                const response = await fetch(baseUrl);
                if (response.ok) {
                    const html = await response.text();
                    if (html.includes('RExeli') && html.includes('Real Estate')) {
                        addResult('Application Load', 'success', 'Main page loads correctly with proper branding');
                    } else {
                        addResult('Application Load', 'warning', 'Page loads but content might be incomplete');
                    }
                } else {
                    addResult('Application Load', 'error', `Failed to load: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                addResult('Application Load', 'error', `Network error: ${error.message}`);
            }
        }

        async function testAPIEndpoints() {
            const endpoints = [
                { path: '/api/upload', method: 'POST', expectedStatus: [400, 422] },
                { path: '/api/classify', method: 'POST', expectedStatus: [400, 422] },
                { path: '/api/extract', method: 'POST', expectedStatus: [400, 422] },
                { path: '/api/export', method: 'POST', expectedStatus: [400, 422] }
            ];

            for (const endpoint of endpoints) {
                try {
                    addResult(`API Test: ${endpoint.path}`, 'loading', 'Testing endpoint...');
                    
                    const response = await fetch(`${baseUrl}${endpoint.path}`, {
                        method: endpoint.method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    });

                    if (endpoint.expectedStatus.includes(response.status)) {
                        addResult(`API: ${endpoint.path}`, 'success', `Endpoint responding correctly (${response.status})`);
                    } else if (response.status === 500) {
                        const errorText = await response.text();
                        addResult(`API: ${endpoint.path}`, 'error', `Server error (500) - possible configuration issue`);
                    } else {
                        addResult(`API: ${endpoint.path}`, 'warning', `Unexpected status: ${response.status}`);
                    }
                } catch (error) {
                    addResult(`API: ${endpoint.path}`, 'error', `Request failed: ${error.message}`);
                }
                
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        async function testFileUpload() {
            addResult('File Upload', 'loading', 'Creating test file and testing upload...');
            
            try {
                // Create a small test PDF-like file
                const testContent = '%PDF-1.4\n1 0 obj\n<< /Type /Catalog /Pages 2 0 R >>\nendobj\n2 0 obj\n<< /Type /Pages /Kids [3 0 R] /Count 1 >>\nendobj\n3 0 obj\n<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] >>\nendobj\nxref\n0 4\n0000000000 65535 f \n0000000010 00000 n \n0000000053 00000 n \n0000000100 00000 n \ntrailer\n<< /Size 4 /Root 1 0 R >>\nstartxref\n150\n%%EOF';
                const testFile = new Blob([testContent], { type: 'application/pdf' });
                
                const formData = new FormData();
                formData.append('file', testFile, 'test-document.pdf');
                
                const response = await fetch(`${baseUrl}/api/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        addResult('File Upload', 'success', 'File upload functionality working correctly');
                    } else {
                        addResult('File Upload', 'warning', `Upload returned: ${result.error || 'Unknown response'}`);
                    }
                } else if (response.status === 400) {
                    addResult('File Upload', 'success', 'Upload endpoint properly validates requests (400 response)');
                } else {
                    const errorText = await response.text();
                    addResult('File Upload', 'error', `Upload failed: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                addResult('File Upload', 'error', `Upload test failed: ${error.message}`);
            }
        }

        async function runAllTests() {
            clearResults();
            addResult('Test Suite', 'loading', 'Starting comprehensive test suite...');
            
            await testBasicFunctionality();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testAPIEndpoints();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testFileUpload();
            
            addResult('Test Suite', 'success', 'All tests completed. Review individual results above.');
        }

        // Auto-run basic test on load
        window.onload = function() {
            setTimeout(testBasicFunctionality, 1000);
        };
    </script>
</body>
</html>